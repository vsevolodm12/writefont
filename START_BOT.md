# Инструкция по запуску Telegram-бота

## Быстрый старт

### 1. Убедитесь, что все установлено

```bash
# Активируйте виртуальное окружение
source venv/bin/activate

# Установите зависимости (если еще не установлены)
pip install -r requirements.txt
```

### 2. Настройте переменные окружения

Убедитесь, что файл `.env` содержит все необходимые данные:

```bash
cat .env
```

Должно быть:
- `BOT_TOKEN` - токен бота (уже установлен)
- `ADMIN_USER_ID` - ваш Telegram ID (получите у @userinfobot и добавьте в .env)
- Параметры базы данных (если нужно изменить)

### 3. Убедитесь, что PostgreSQL запущен

```bash
# Проверьте статус
brew services list

# Если не запущен, запустите
brew services start postgresql@15
```

### 4. Инициализируйте базу данных (если еще не сделали)

```bash
python database/db_init.py
```

### 5. Проверьте подключение к БД

```bash
python database/test_connection.py
```

Должно вывести:
```
✓ Успешное подключение к PostgreSQL
✓ Найдено таблиц: 2
  - jobs
  - users
```

### 6. Запустите бота

```bash
python bot.py
```

Если все настроено правильно, вы увидите:
```
2024-XX-XX XX:XX:XX - INFO - Бот запущен и готов к работе!
```

## Проверка работы бота

1. Откройте Telegram и найдите вашего бота
2. Отправьте команду `/start`
3. Если вы не администратор, бот ответит ошибкой доступа - нужно установить `ADMIN_USER_ID` в `.env`

## Команды бота

- `/start` - начать работу, показать текущие настройки
- `/upload_font` - загрузить TTF/OTF шрифт
- `/set_format` - выбрать формат страницы (A4 или тетрадь)

## Использование

1. **Загрузка шрифта:**
   - Отправьте `/upload_font`
   - Отправьте файл с расширением .ttf или .otf
   - Бот сохранит шрифт и подтвердит загрузку

2. **Выбор формата страницы:**
   - Отправьте `/set_format`
   - Выберите формат через кнопки

3. **Генерация PDF (будет реализовано позже):**
   - Отправьте текст боту
   - Бот сгенерирует PDF с вашим шрифтом

## Решение проблем

### Бот не отвечает

- Проверьте, что бот запущен (`python bot.py`)
- Проверьте токен в `.env`
- Проверьте интернет-соединение

### Ошибка "Доступ запрещен"

- Установите правильный `ADMIN_USER_ID` в `.env`
- Получите свой ID от @userinfobot в Telegram
- Перезапустите бота

### Ошибка подключения к БД

```bash
# Проверьте статус PostgreSQL
brew services list

# Перезапустите PostgreSQL
brew services restart postgresql@15

# Проверьте подключение
python database/test_connection.py
```

### Ошибка при загрузке шрифта

- Убедитесь, что файл имеет расширение .ttf или .otf
- Проверьте размер файла (должен быть разумным)
- Убедитесь, что директория `fonts/` создана

## Автозапуск при перезагрузке Mac (опционально)

Создайте файл `launchd.plist` для автозапуска бота:

```bash
# Создайте директорию для логов
mkdir -p ~/Library/Logs/consp_bot

# Создайте plist файл (потребуется настроить пути)
```

Или используйте `screen`/`tmux` для фонового запуска:

```bash
# Установите screen
brew install screen

# Запустите бота в screen сессии
screen -S bot
source venv/bin/activate
cd /Users/vsevolodmarcenko/Desktop/consp_bot
python bot.py

# Отключитесь: Ctrl+A, затем D
# Вернуться: screen -r bot
```

